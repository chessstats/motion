<!DOCTYPE html>
<html>

<head>

<title></title>

<!-- shiny includes -->

<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<meta name="viewport" content="width=device-width, initial-scale=1" />

<link href="shared/shiny.css" rel="stylesheet" />
<link href="shared/bootstrap/css/bootstrap.min.css" rel="stylesheet" />

<script type="application/shiny-singletons"></script>
<script src="shared/json2-min.js"></script>
<script src="shared/jquery.min.js"></script>
<script src="shared/shiny.min.js"></script>
<script src="shared/bootstrap/js/bootstrap.min.js"></script>
<script src="shared/bootstrap/shim/html5shiv.min.js"></script>
<script src="shared/bootstrap/shim/respond.min.js"></script>

<!-- local shiny includes from the www folder -->

<link rel="stylesheet" type="text/css" href="jquery.dataTables.min.css">

<script src="htmlwidgets.js"></script>
<script src="datatables.js"></script>
<script type="text/javascript" charset="utf8" src="jquery.dataTables.min.js"></script>
<script src="plotly-latest.min.js"></script>
<script src="plotly.js"></script>

<!-- web -->

<script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
<!--<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>-->
<!--<link rel="stylesheet" type="text/css" href="//cdn.datatables.net/1.10.10/css/jquery.dataTables.css">-->
<!--<script type="text/javascript" charset="utf8" src="//cdn.datatables.net/1.10.10/js/jquery.dataTables.js"></script>-->

<!-- user defined -->

<link href="divs.css" rel="stylesheet" />

</head>

<body>

<script>

var cval=0;
// handlers
function setInnerHTML(message)
{
	document.getElementById(message[0]).innerHTML=message[1];
}
function setTable(message)
{
	document.getElementById(message[0]).innerHTML=message[1];
	$('#'+message[2]).DataTable();
}
function setPlot(message)
{
	Plotly.newPlot(document.getElementById(message[0]),JSON.parse(message[1]),JSON.parse(message[2]));	
}
var players;
var selplayers;
var numplayers;
function setPlayers(message)
{
	players=message;
	numplayers=players.length;
	selplayers=new Array(numplayers);
	for(var i=0; i<selplayers.length; ++i) { selplayers[i]=false; }
}
// end handlers

var lastletter="-";

function pchcont(sel){
	if(sel){
		return '<img class="selicon" src="selected.png">'
	}
	return '<img class="selicon" src="unselected.png">'
}

function handlePlayerCheckbox(i){
	selplayers[i]=!selplayers[i];
	$('#pch'+i.toString()).html(pchcont(selplayers[i]))
	var selpis=new Array(0);
	for(j=0;j<numplayers;j++) {
		if(selplayers[j]) {
			selpis.push(players[j]);
		}
	}
	cval=cval+1;Shiny.onInputChange('control',selpis);
}

function clearSelect(){
	$(".playerselect").slideUp();
	lastletter="-";
}

var letter="+"
function selectLetterInner()
{
	var buff="";
	var found=0
	for(i=0;i<numplayers;i++)
	{
		var player=players[i]
		var ok;
		if(letter==0){
			ok=selplayers[i]
		}else{
			ok=(player.charAt(0)==letter);
		}
		if(ok){
			var checked=pchcont(false);
			found++;
			if(selplayers[i]){
				checked=pchcont(true);
			}
			buff+=('<span onmousedown="handlePlayerCheckbox('+i+')"><span id="pch'+i+'">'+checked+'</span>&nbsp;<a href="#">'+
				player+"</a></span><br>");
		}
	}
	if(found==0){
		buff="no players found"
	}
	var psdiv='<div class="playerselectinner">'+buff+'</div><div class="playerselectexit"><img src="delt.png" onmousedown="clearSelect();"></div>'
	$(".playerselect").html(psdiv);
	var pos=$("#selpb"+letter).position().left;
	if(pos>600){pos=600;}
	pos-=40;
	$(".playerselect").css("left",pos.toString()+"px")
	$(".playerselect").slideDown();
}

function selectLetter(setletter){
	letter=setletter;
	if(letter===lastletter){
		clearSelect();
		return;
	}
	if(lastletter==="-"){
		lastletter=letter;
		$(".playerselect").slideUp(100,selectLetterInner);
	}
	else{
		lastletter="-";
		$(".playerselect").slideUp(100,selectLetterInner);
	}
}

// build letter menu
function buildLetterMenu()
{
	var buff='&nbsp;Players:&nbsp;<button class="letterbutton" id="selpb0" onClick="selectLetter(0);">Remove</button>';
	for(i="A".charCodeAt(0);i<"Z".charCodeAt(0);i++)
	{
		var letter=String.fromCharCode(i);
		buff+=('<button class="letterbutton" id="selpb'+letter+'" onclick="selectLetter('+"'"+letter+"'"+');">'+letter+'</button>');
	}
	$('.menu').html(buff);
}

// startup
$(document).ready(function(){
	// bind handlers
	Shiny.addCustomMessageHandler("setTable",setTable);
	Shiny.addCustomMessageHandler("setPlot",setPlot);
	Shiny.addCustomMessageHandler("setInnerHTML",setInnerHTML);
	Shiny.addCustomMessageHandler("setPlayers",setPlayers);
	// end bind handlers

	d3.select("body").style("background-color", "#ffffff");
	d3.select("body").transition().duration(1000).delay(1000).style("background-color", "#dfdfdf");

	buildLetterMenu();

	$(function() {
  	setTimeout(function() {
    	Shiny.onInputChange('rplayers',1);
    	Shiny.onInputChange('control',["Carlsen..Magnus","Nakamura..Hikaru"]);
  	}, 1000)
});


	

});
// end startup

</script>

<div class="parent">
  <div class="menu">
	<button id="cbutton" onmousedown="cval=cval+1;Shiny.onInputChange('rplayers',cval);">Control</button>
  </div>
  <div class="playerselect">
  Select players by clicking on their initial letter
  </div>
    <div class="content">
    	<div id="trendPlot" class="plotly html-widget html-widget-output"></div>
    </div>
    <!--<div id="dataTable" style="width:100%; height:auto" class="datatables html-widget html-widget-output"></div>
  	<div id="tablecont"></div>
	<div id="svgcont"></div>
  	<div id="plotlycont"></div>-->
  </div>
</div>

</body>

</html>